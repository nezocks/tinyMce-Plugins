/**
 * TinyMCE version 6.7.0 (2023-08-30)
 * Copyright (c) 2024. All rights reserved.
 * For information, see README.md or https://github.com/nezocks/tinyMce-Plugins
 */
tinymce.PluginManager.add("shortcodes",function(t){let e=t.getElement(),_=e.getAttribute("data-shortcodes"),$=e.getAttribute("data-shortcodes-url"),o=e.getAttribute("data-shortcodes-mode")||"clipboard-paste";(_||$)&&(t.ui.registry.addIcon("shortcodes",'<svg width="24px" height="24px" viewBox="0 0 17 17"><path d="M0.026 1h3v1h-2v13h2v1h-3v-15zM14.026 1v1h2v13h-2v1h3v-15h-3zM8.91 7.967c-1.115-0.433-1.607-0.804-1.607-1.56 0-0.552 0.42-1.211 1.523-1.211 0.731 0 1.271 0.239 1.535 0.384l0.288-0.852c-0.359-0.204-0.96-0.396-1.787-0.396-1.571 0-2.614 0.936-2.614 2.195 0 1.14 0.815 1.823 2.135 2.291 1.091 0.419 1.523 0.851 1.523 1.606 0 0.815-0.624 1.38-1.691 1.38-0.72 0-1.403-0.24-1.871-0.528l-0.264 0.876c0.432 0.287 1.283 0.516 2.062 0.516 1.907 0 2.831-1.079 2.831-2.327 0.001-1.188-0.696-1.847-2.063-2.374z" fill="#000000" /></svg>'),t.ui.registry.addMenuButton("shortcodes",{icon:"shortcodes",tooltip:"Шорткоди",fetch:function(e){function n(e,_){("clipboard"===_||"clipboard-paste"===_)&&function t(e){let _=document.createElement("input");_.style.position="absolute",_.style.left="-9999px",_.value=e,document.body.appendChild(_),_.select();try{document.execCommand("copy"),i(`Шорткод ${e} скопійовано!`,"info")}catch{i("Копіювання не вдалося!","error")}document.body.removeChild(_)}(e),("paste"===_||"clipboard-paste"===_)&&t.insertContent(e);let $=t.getContainer().querySelector(".tox-tbtn.tox-tbtn--enabled");$&&$.click()}function i(e,_){t.notificationManager.open({text:e,type:_,timeout:2e3})}_?function t(e,_){try{let $=JSON.parse(e).map(({key:t,name:e})=>({type:"menuitem",text:`${e} - ${t}`,onAction:()=>n(t,o)}));_($)}catch(c){i("Шорткоди не знайдено","error"),_([])}}(_,e):function t(e,_){fetch(e).then(t=>t.json()).then(t=>{_(t.shortcodes.map(({key:t,name:e})=>({type:"menuitem",text:`${e} - ${t}`,onAction:()=>n(t,o)})))}).catch(t=>{i("Помилка: "+t.message,"error"),_([])})}($,e)}}))});


// tinymce.PluginManager.add('shortcodes', function(editor) {
//     const elem = editor.getElement();
//     const shortcodesAttr = elem.getAttribute('data-shortcodes');
//     const shortcodesUrl = elem.getAttribute('data-shortcodes-url');
//     const shortcodeMode = elem.getAttribute('data-shortcodes-mode') || 'clipboard-paste';
//
//     // Якщо немає тегу data-shortcodes і data-shortcodes-url, то не виводимо нічого
//     if (!shortcodesAttr && !shortcodesUrl) return;
//
//     editor.ui.registry.addIcon('shortcodes', '<svg width="24px" height="24px" viewBox="0 0 17 17"><path d="M0.026 1h3v1h-2v13h2v1h-3v-15zM14.026 1v1h2v13h-2v1h3v-15h-3zM8.91 7.967c-1.115-0.433-1.607-0.804-1.607-1.56 0-0.552 0.42-1.211 1.523-1.211 0.731 0 1.271 0.239 1.535 0.384l0.288-0.852c-0.359-0.204-0.96-0.396-1.787-0.396-1.571 0-2.614 0.936-2.614 2.195 0 1.14 0.815 1.823 2.135 2.291 1.091 0.419 1.523 0.851 1.523 1.606 0 0.815-0.624 1.38-1.691 1.38-0.72 0-1.403-0.24-1.871-0.528l-0.264 0.876c0.432 0.287 1.283 0.516 2.062 0.516 1.907 0 2.831-1.079 2.831-2.327 0.001-1.188-0.696-1.847-2.063-2.374z" fill="#000000" /></svg>');
//
//     editor.ui.registry.addMenuButton('shortcodes', {
//         icon: 'shortcodes',
//         tooltip: 'Шорткоди',
//         fetch: function(callback) {
//             if (shortcodesAttr) {
//                 processShortcodes(shortcodesAttr, callback);
//             } else {
//                 fetchShortcodes(shortcodesUrl, callback);
//             }
//
//             function processShortcodes(attr, callback) {
//                 try {
//                     let items = JSON.parse(attr).map(({ key, name }) => ({
//                         type: 'menuitem',
//                         text: `${name} - ${key}`,
//                         onAction: () => handleShortcodeAction(key, shortcodeMode)
//                     }));
//                     callback(items);
//                 } catch (error) {
//                     notify('Шорткоди не знайдено', 'error');
//                     callback([]);
//                 }
//             }
//
//             function fetchShortcodes(url, callback) {
//                 fetch(url)
//                     .then(response => response.json())
//                     .then(result => {
//                         let items = result.shortcodes.map(({ key, name }) => ({
//                             type: 'menuitem',
//                             text: `${name} - ${key}`,
//                             onAction: () => handleShortcodeAction(key, shortcodeMode)
//                         }));
//                         callback(items);
//                     })
//                     .catch(error => {
//                         notify('Помилка: ' + error.message, 'error');
//                         callback([]);
//                     });
//             }
//
//             function handleShortcodeAction(key, mode) {
//                 if (mode === 'clipboard' || mode === 'clipboard-paste') {
//                     copyToClipboard(key);
//                 }
//                 if (mode === 'paste' || mode === 'clipboard-paste') {
//                     editor.insertContent(key);
//                 }
//
//                 const button = editor.getContainer().querySelector('.tox-tbtn.tox-tbtn--enabled');
//                 if (button) button.click();
//             }
//
//             function copyToClipboard(text) {
//                 const tempInput = document.createElement('input');
//                 tempInput.style.position = 'absolute';
//                 tempInput.style.left = '-9999px';
//                 tempInput.value = text;
//                 document.body.appendChild(tempInput);
//                 tempInput.select();
//                 try {
//                     document.execCommand('copy');
//                     notify(`Шорткод ${text} скопійовано!`, 'info');
//                 } catch {
//                     notify('Копіювання не вдалося!', 'error');
//                 }
//                 document.body.removeChild(tempInput);
//             }
//
//             function notify(message, type) {
//                 editor.notificationManager.open({
//                     text: message,
//                     type: type,
//                     timeout: 2000
//                 });
//             }
//         }
//     });
// });
